# 누락된 기능 목록

> **최종 업데이트**: 2026-01-13
> **분석 대상**: brain_tumor_front/src, brain_tumor_back/

---

# Part A: 백엔드 누락 기능

## A.1 PDF 출력 API (미구현)

| 항목 | 내용 |
|------|------|
| **상태** | ❌ 미구현 |
| **위치** | `apps/reports/views.py` |
| **설명** | Reports 앱에 CRUD만 있고 PDF 생성/다운로드 기능 없음 |
| **필요 라이브러리** | `reportlab` 또는 `weasyprint` |
| **구현 예정 API** | `GET /api/reports/{id}/pdf/` |

**구현 예시**:
```python
from django.http import HttpResponse
from reportlab.pdfgen import canvas
from reportlab.lib.pagesizes import A4
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont

class FinalReportPDFView(APIView):
    """보고서 PDF 다운로드"""
    permission_classes = [IsDoctorOrAdmin]

    def get(self, request, pk):
        report = get_object_or_404(FinalReport, pk=pk, is_deleted=False)

        response = HttpResponse(content_type='application/pdf')
        response['Content-Disposition'] = f'attachment; filename="report_{report.report_number}.pdf"'

        p = canvas.Canvas(response, pagesize=A4)
        # 한글 폰트 등록 필요
        p.drawString(100, 800, f"진료 보고서 #{report.report_number}")
        p.drawString(100, 780, f"환자: {report.patient.name}")
        p.drawString(100, 760, f"작성일: {report.created_at.strftime('%Y-%m-%d')}")
        # ... 보고서 내용 추가
        p.save()

        return response
```

---

## A.2 Excel/CSV 내보내기 API (미구현)

| 항목 | 내용 |
|------|------|
| **상태** | ❌ 미구현 |
| **위치** | 전체 앱 (patients, ocs, encounters, reports) |
| **설명** | 데이터 목록을 Excel/CSV로 내보내기 기능 없음 |
| **필요 라이브러리** | `openpyxl` (Excel), 내장 `csv` 모듈 |

**필요한 내보내기 API**:
| API | 설명 |
|-----|------|
| `GET /api/patients/export/` | 환자 목록 내보내기 |
| `GET /api/ocs/export/` | OCS 목록 내보내기 |
| `GET /api/encounters/export/` | 진료 목록 내보내기 |
| `GET /api/audit/export/` | 감사 로그 내보내기 |

**구현 예시**:
```python
import csv
from django.http import HttpResponse

class PatientExportView(APIView):
    """환자 목록 CSV 내보내기"""
    permission_classes = [IsAdmin]

    def get(self, request):
        response = HttpResponse(content_type='text/csv; charset=utf-8-sig')
        response['Content-Disposition'] = 'attachment; filename="patients.csv"'

        writer = csv.writer(response)
        writer.writerow(['환자번호', '이름', '생년월일', '성별', '연락처', '등록일'])

        patients = Patient.objects.filter(is_deleted=False)
        for p in patients:
            writer.writerow([
                p.patient_number, p.name, p.birth_date,
                p.gender, p.phone, p.created_at.strftime('%Y-%m-%d')
            ])

        return response
```

---

## A.3 AI 자동 추론 트리거 (미구현)

| 항목 | 내용 |
|------|------|
| **상태** | ❌ 미구현 |
| **위치** | `apps/ocs/views.py` → `apps/ai_inference/` |
| **설명** | RIS/LIS 확정(CONFIRMED) 시 AI 모델 자동 추론 요청 |
| **제약사항** | `apps/ai_inference/`는 다른 작업자 담당 - 연동 인터페이스만 정의 |

**트리거 조건**:
| OCS 유형 | 확정 시 | AI 모델 |
|----------|---------|---------|
| RIS (MRI) | T1, T2, T1C, FLAIR 모두 존재 | M1 (MRI 4-Channel) |
| LIS (GENETIC) | RNA_seq 데이터 존재 | MG (Genetic Analysis) |
| RIS + LIS | 위 조건 모두 충족 | MM (Multimodal) |

**구현 위치**: `apps/ocs/views.py` - `submit_result()` 또는 `confirm()` 액션

---

## A.4 Redis + Celery 비동기 처리 (미구현)

| 항목 | 내용 |
|------|------|
| **상태** | ❌ 미구현 |
| **위치** | 인프라 / `config/celery.py` |
| **설명** | AI 추론 등 오래 걸리는 작업의 비동기 처리 |
| **필요 패키지** | `celery`, `redis`, `django-celery-beat` |

**필요한 비동기 작업**:
- AI 추론 요청 처리
- PDF 대량 생성
- 데이터 내보내기 (대용량)
- 이메일/알림 발송

---

## A.5 worker_result RIS 필드 확장 (부분 구현)

| 항목 | 내용 |
|------|------|
| **상태** | ⚠️ 부분 구현 |
| **위치** | `apps/ocs/models.py` |
| **설명** | RIS worker_result에 series_id, series_type 필드 추가 필요 |

**현재 RIS 템플릿**:
```json
{
  "_template": "RIS",
  "findings": "",
  "impression": "",
  "tumor": { "detected": false },
  "dicom": { "study_uid": "", "series_count": 0 }
}
```

**확장 필요**:
```json
{
  "_template": "RIS",
  "findings": "",
  "impression": "",
  "tumor": { "detected": false, "location": {}, "size": {} },
  "dicom": {
    "study_uid": "",
    "series_count": 0,
    "series": [
      { "series_id": "xxx", "series_type": "T1", "instance_count": 120 },
      { "series_id": "yyy", "series_type": "T2", "instance_count": 120 },
      { "series_id": "zzz", "series_type": "T1C", "instance_count": 120 },
      { "series_id": "aaa", "series_type": "FLAIR", "instance_count": 120 }
    ]
  }
}
```

---

## A.6 통계 리포트 API (미구현)

| 항목 | 내용 |
|------|------|
| **상태** | ❌ 미구현 |
| **위치** | `apps/common/views.py` 또는 신규 `apps/statistics/` |
| **설명** | 기간별/유형별 상세 통계 조회 |

**필요한 API**:
| API | 설명 |
|-----|------|
| `GET /api/statistics/ocs/` | OCS 처리 통계 (기간별, 유형별, 상태별) |
| `GET /api/statistics/patients/` | 환자 통계 (연령대별, 성별, 진단별) |
| `GET /api/statistics/ai/` | AI 추론 통계 (모델별, 정확도, 처리시간) |

---

## A.7 환자 포털 API (미구현)

| 항목 | 내용 |
|------|------|
| **상태** | ❌ 미구현 |
| **위치** | `apps/patients/views.py` 또는 신규 |
| **설명** | 환자 본인 조회용 API (프론트엔드 환자 포털 페이지용) |

**필요한 API**:
| API | 설명 |
|-----|------|
| `GET /api/patient/me/exams/` | 내 검사 결과 |
| `GET /api/patient/me/appointments/` | 내 진료 예약 |
| `GET /api/patient/me/visits/` | 내 방문 기록 |

---

## A.8 일괄 처리 API (미구현)

| 항목 | 내용 |
|------|------|
| **상태** | ❌ 미구현 |
| **설명** | 여러 OCS 일괄 상태 변경 |

**필요한 API**:
- `POST /api/ocs/bulk-accept/` - 일괄 접수
- `POST /api/ocs/bulk-confirm/` - 일괄 확정

---

## A.9 백엔드 필요 패키지

`requirements.txt`에 추가 필요:

```txt
# PDF 생성
reportlab==4.0.0
# 또는
weasyprint==60.0

# Excel 생성
openpyxl==3.1.2

# 비동기 처리
celery==5.3.0
redis==5.0.0
django-celery-beat==2.5.0
django-celery-results==2.5.0

# 이메일 (선택)
django-anymail==10.0
```

---

# Part B: 프론트엔드 누락 기능

## 1. PDF 출력 기능 (미구현)

| 우선순위 | 페이지 | 파일 | 현재 상태 | 필요 작업 |
|---------|--------|------|----------|----------|
| 높음 | RIS 판독 상세 | `pages/ocs/RISStudyDetailPage.tsx` | 주석만 있음 ("PDF 출력") | PDF 생성 및 다운로드 |
| 높음 | LIS 검사 상세 | `pages/ocs/LISStudyDetailPage.tsx` | 미구현 | 검사 결과 PDF 내보내기 |
| 중간 | 영상 판독 리포트 | `pages/imaging/ImagingReportPage.tsx` | 미구현 | 판독 리포트 PDF |
| 중간 | 진료 기록 | `pages/clinic/ClinicPage.tsx` | 미구현 | 진료 요약 PDF |

### 구현 방안
```bash
npm install jspdf html2canvas
# 또는
npm install @react-pdf/renderer
```

---

## 2. Excel/CSV 내보내기 (미구현)

| 우선순위 | 페이지 | 파일 | 필요 작업 |
|---------|--------|------|----------|
| 높음 | 영상 검사 목록 | `pages/imaging/ImagingListPage.tsx` | 테이블 데이터 Excel 다운로드 |
| 높음 | 검사 결과 목록 | `pages/lab/LabListPage.tsx` | 테이블 데이터 Excel 다운로드 |
| 중간 | 진료 기록 목록 | `pages/encounter/EncounterListPage.tsx` | 테이블 데이터 Excel 다운로드 |
| 중간 | 환자 목록 | `pages/patient/PatientListPage.tsx` | 테이블 데이터 Excel 다운로드 |
| 낮음 | 감사 로그 | `pages/admin/AuditLog.tsx` | 로그 데이터 Excel 다운로드 |

### 구현 방안
```bash
npm install xlsx file-saver
# 또는
npm install exceljs
```

---

## 3. 프린트 기능 (미구현)

| 페이지 | 파일 | 필요 작업 |
|--------|------|----------|
| RIS 판독 상세 | `pages/ocs/RISStudyDetailPage.tsx` | 맞춤 프린트 레이아웃 |
| LIS 검사 상세 | `pages/ocs/LISStudyDetailPage.tsx` | 맞춤 프린트 레이아웃 |
| 영상 판독 리포트 | `pages/imaging/ImagingReportPage.tsx` | 맞춤 프린트 레이아웃 |
| 진료 요약 | `pages/clinic/ClinicPage.tsx` | 맞춤 프린트 레이아웃 |

### 구현 방안
```tsx
// @media print CSS 활용
// 또는 react-to-print 라이브러리
npm install react-to-print
```

---

## 4. 환자 포털 빈 페이지 (계획됨)

| 우선순위 | 페이지 | 파일 | 현재 상태 | 필요 작업 | 계획 |
|---------|--------|------|----------|----------|------|
| 높음 | 내 검사결과 | `pages/patient/MyExamList.tsx` | 제목만 있음 | 환자 본인 검사 결과 조회 | Phase 2 예정 |
| 높음 | 내 진료예약 | `pages/patient/MySummary.tsx` | 제목만 있음 | 오늘 진료 예약 확인 | Phase 2 예정 |
| 높음 | 과거 방문기록 | `pages/patient/MyVisitList.tsx` | 제목만 있음 | 과거 방문 기록 조회 | Phase 2 예정 |

### 구현 계획

**백엔드 API 필요** (A 에이전트):
```
GET /api/patient/me/exams/         # 내 검사 결과
GET /api/patient/me/appointments/  # 내 진료 예약
GET /api/patient/me/visits/        # 내 방문 기록
```

**프론트엔드 구현** (B 에이전트):
1. `MyExamList.tsx` - 검사 결과 목록 테이블, 상태 배지, 상세 보기 링크
2. `MySummary.tsx` - 오늘 예약 카드, 예약 시간/의사/진료실 표시
3. `MyVisitList.tsx` - 방문 기록 타임라인, 날짜/진료유형/담당의 표시

**의존성**: 백엔드 API 구현 후 프론트엔드 작업 가능

---

## 5. AI 기능 TODO (부분 구현)

| 파일 | 라인 | TODO 내용 | 필요 작업 |
|------|------|----------|----------|
| `pages/ai/AiResultPanel.tsx` | 7 | AI 분석 결과 API 연동 | 실제 API 호출로 교체 |
| `pages/ai/AiResultPanel.tsx` | 27 | 실제 분석 결과 표시 | hasAnalysisResult 로직 구현 |
| `pages/ocs/components/AIAnalysisPanel.tsx` | 49 | 목업 데이터 제거 | 실제 AI API 연동 |
| `pages/ocs/components/AIAnalysisPanel.tsx` | 130 | AI 분석 API 구현 | getAIAnalysisResult 함수 |
| `pages/ocs/components/AIAnalysisPanel.tsx` | 173 | "추후 AI 모델 연동" | AI 분석 결과 표시 |

### 필요 API (백엔드)
```
GET /api/ai-inference/results/{patient_id}/  # 환자별 AI 분석 결과
POST /api/ai-inference/analyze/              # AI 분석 요청
```

---

## 6. 관리자 페이지 하드코딩 (부분 구현)

| 페이지 | 파일 | 현재 상태 | 필요 작업 |
|--------|------|----------|----------|
| 감사 로그 | `pages/admin/AuditLog.tsx` | 샘플 데이터 하드코딩 | 실제 API 연동 |
| 시스템 모니터링 | `pages/admin/SystemMonitorPage.tsx` | 더미 카드만 | 실시간 모니터링 데이터 |

### 필요 API (백엔드)
```
GET /api/admin/audit-logs/        # 감사 로그 조회
GET /api/admin/system/status/     # 시스템 상태 (CPU, Memory, 서버 상태)
```

---

## 7. 기타 누락 기능

| 기능 | 설명 | 우선순위 |
|------|------|---------|
| EMR 전송 | RIS 판독 결과 EMR 전송 버튼 (RISStudyDetailPage) | 중간 |
| 알림 기능 | 실시간 알림/토스트 메시지 시스템 | 낮음 |
| 다국어 지원 | i18n 국제화 | 낮음 |
| 다크 모드 | 테마 전환 기능 | 낮음 |

---

## 구현 우선순위 정리

### Phase 1 (즉시 필요)
1. PDF 출력 - RIS/LIS 상세 페이지
2. 환자 포털 페이지 구현
3. AI 분석 결과 API 연동

### Phase 2 (1-2주)
1. Excel 내보내기 - 목록 페이지들
2. 프린트 기능
3. 감사 로그 API 연동

### Phase 3 (3-4주)
1. 시스템 모니터링 실시간 데이터
2. EMR 전송 기능
3. 알림 시스템

---

## 참고: 이미 구현된 기능

- [x] 환자 목록 조회/검색/필터링/CRUD
- [x] 진료 기록(Encounter) 관리
- [x] 영상 검사(RIS) 주문 및 상세 조회
- [x] 검사 결과(LIS) 주문 및 상세 조회
- [x] 진료 화면(Clinic Page) - 3컬럼 그리드 레이아웃
- [x] 대시보드 (의사/간호사/RIS 역할별)
- [x] 치료 계획 관리
- [x] 사용자 권한 관리
- [x] 인증/로그인/비밀번호 변경
- [x] OCS 통합 관리 기본 구조

---

# Part C: 구현 우선순위 종합

## 즉시 필요 (Phase 1)

| 순서 | 기능 | 담당 | 이유 |
|------|------|------|------|
| 1 | PDF 출력 API | Backend | 의료 보고서 필수 기능 |
| 2 | PDF 출력 UI | Frontend | 백엔드 API 연동 |
| 3 | 환자 포털 API | Backend | 프론트엔드 페이지 필요 |
| 4 | 환자 포털 UI | Frontend | API 연동 |

## 1-2주 내 (Phase 2)

| 순서 | 기능 | 담당 | 이유 |
|------|------|------|------|
| 5 | Excel/CSV 내보내기 API | Backend | 데이터 관리 필수 |
| 6 | Excel 내보내기 UI | Frontend | 백엔드 API 연동 |
| 7 | AI 자동 추론 트리거 | Backend | 시스템 핵심 기능 |
| 8 | AI 분석 결과 API 연동 | Frontend | 목업 데이터 제거 |

## 3-4주 내 (Phase 3)

| 순서 | 기능 | 담당 |
|------|------|------|
| 9 | worker_result 확장 | Backend |
| 10 | Redis + Celery | Backend (인프라) |
| 11 | 통계 API | Backend |
| 12 | 시스템 모니터링 | Frontend + Backend |

---

**문서 끝**
